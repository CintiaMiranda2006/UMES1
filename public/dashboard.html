<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>

  <link rel="stylesheet" href="dashboard.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="carregarPagina()">

  <div class="nav-bar">
    <h2 id="nome_usuario"> Olá estudante </h2>
    <div class="links">
      <a href="pagina_inicial.html">Inicio</a>
      <a href="quiz.html">Questionário</a>
      <a href="dashboard.html">Dashboard</a>
    </div>


    <div class="sair">
      <a href="index.html">SAIR</a>
    </div>

  </div>

  <div class="pai-grafico">


    <div class="kpis-linha">

      <div class="kpi">
        <p>Menor Pontuação</p>
        <span id="kpi1">Sem valor</span>
      </div>

      <div class="kpi">
        <p> Tentativas </p>
        <span id="kpi2">Sem valor</span>
      </div>

      <div class="kpi">
        <p> Maior Pontuação</p>
        <span id="kpi3">Sem valor</span>
      </div>

    </div>


    <div class="grafico1">
      <canvas id="graficoUMES" width="690" height="450"></canvas>
    </div>

</body>
</div>

</div>


</html>

<script>
  function carregarPagina() {
    var nomeUsuario = sessionStorage.NOME_USUARIO;
    nome_usuario.innerHTML = `Olá, ${nomeUsuario}!`;
    var idUsuario = sessionStorage.ID_USUARIO;
    console.log(idUsuario);

    fetch(`/resultado/buscarDadosKPI/${idUsuario}`, {

    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO buscarDadosKPI()!")

      if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {
          console.log(json);
          console.log(JSON.stringify(json));
          menorPontuacao = json.menorPontuacao;
          totalTentativa = json.totalResultado;
          maiorPontuacao = json.maiorPontuacao;

          kpi1.innerHTML = `${menorPontuacao}`;
          kpi2.innerHTML = `${totalTentativa}`;
          kpi3.innerHTML = `${maiorPontuacao}`;


          console.log(menorPontuacao, totalTentativa, maiorPontuacao)
        });

      } else {

        console.log("Houve um erro ao tentar buscar os dados!");

        resposta.text().then(texto => {
          console.error(texto);
        });
      }

    }).catch(function (erro) {
      console.log(erro);
    })

    fetch(`/resultado/buscarDadosGrafico/${idUsuario}`, {

    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO buscarDadosGrafico()!")

      if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {
          console.log(json);
          console.log(JSON.stringify(json));
          // passar os dados json para variáveis e criar o gráfico
          var tentativa1 = json[0].acertos;
          var tentativa2 = json[1].acertos;
          var tentativa3 = json[2].acertos;
          var tentativa4 = json[3].acertos;

          console.log(tentativa1, tentativa2, tentativa3, tentativa4);

          const ctx = document.getElementById('graficoUMES');
          var titulos = ['tentativa1', 'tentatva2', 'tentativa3', 'tentativa4']
          var valores = [tentativa1, tentativa2, tentativa3, tentativa4]

         new Chart(ctx, {
  type: 'bar',
  data: {
    labels: titulos,
    datasets: [{
      label: 'TENTATIVAS DO USUARIO',
      data: valores,
      backgroundColor: '#6B0101',
      borderColor: '#c9c9c9',
      borderWidth: 2
    }]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          color: '#000000',
          font: {
            size: 14
          }
        },
        grid: {
          color: 'rgba(107, 1, 1, 0.25)'
        }
      },
      x: {
        ticks: {
          color: '#000000',
          font: {
            size: 14
          }
        },
        grid: {
          display: false
        }
      }
    },
    plugins: {
      legend: {
        labels: {
          color: '#000000',
          font: {
            size: 16,
            weight: 'bold'
          }
        }
      }
    }
  }
})
});
      } else {

        console.log("Houve um erro ao tentar buscar os dados!");

        resposta.text().then(texto => {
          console.error(texto);
        });
      }

    }).catch(function (erro) {
      console.log(erro);
    })

    return false;
  }

</script>